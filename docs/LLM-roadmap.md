# LLM Backend 장기 로드맵

본 문서는 CoE 백엔드/에이전트 스택을 장기적으로 안정화하고, 로그 기반 도메인 특화와 다중 에이전트 확장을 포함한 진화 전략을 정리합니다. 각 단계는 선행 KPI 확립 → 비용/성능 최적화 → 데이터 파이프라인 정비 → 도구 오케스트레이션 고도화 → 도메인 적응 강화 → agent-to-agent 확장 순으로 진행됩니다.

## 로드맵 개요
| 단계 | 기간(예상) | 핵심 목표 | 대표 산출물 |
| --- | --- | --- | --- |
| 1. 신뢰성 확보 | 0~2주 | 라우팅 안정화, 모니터링 지표 고정 | 관측 대시보드, 실패 회귀 테스트, OpenAI fallback 토글 |
| 2. 비용·성능 최적화 | 2~6주 | 토큰 사용량 관리, RAG/요약 최소화 | 프롬프트 템플릿 경량화, BatchScheduler 정책, top-k 실험 리포트 |
| 3. 데이터 파이프라인 정비 | 6~10주 | DB↔로그 정합성, 지식 만료 정책 | 동기화 포인터 가이드, 지식 품질 워크플로, 재처리 스크립트 |
| 4. 도구 오케스트레이션 고도화 | 10~16주 | 툴 호출 신뢰도, 운영자 제어성 | 툴 응답 스키마, 재시도/롤백 규칙, 툴 정책 설정 |
| 5. 로그 기반 도메인 적응 강화 | 16~24주 | 그룹/글로벌 지식 승격, 경량 파인튜닝 준비 | 승격 워크플로, 카드 품질 지표, LoRA 후보 모델 |
| 6. Agent-to-Agent 확장 | 24주~ | 다중 에이전트 협업, 교차 도메인 시나리오 | 에이전트 상호 협의 프로토콜, 조정 코디네이터, 샌드박스 테스트 |

## 1단계: 신뢰성 확보 (0~2주)
- **지표 고정**: `token_usage`, `tool_call_ratio`, `routing_success_rate`, `cost_per_success`를 포함한 대시보드 구성. 임계치 초과 시 경보 규칙을 설정합니다.
- **실패 패턴 회귀 테스트**: 현재 라우팅 실패 사례를 수집해 재현 테스트를 작성하고 CI에 포함합니다.
- **Fallback 전략**: `fallback_to_openai` 플래그를 도입해 치명적 장애 시 기본 OpenAI 경로로 우회할 수 있도록 합니다.

## 2단계: 비용·성능 최적화 (2~6주)
- **프롬프트/툴 설명 모듈화**: 시스템 메시지와 툴 가이드를 템플릿화하고 경량 버전을 마련합니다.
- **BatchScheduler 강화**: 고비용 세션을 별도 큐로 분리하고 델타 요약 강제, 임베딩 중복 제거를 구현합니다.
- **RAG 파라미터 실험**: `global_topk`, `group_topk`, 요약 길이 등의 조합을 AB 테스트하여 비용 대비 품질 최적점을 찾습니다.

## 3단계: 데이터 파이프라인 정비 (6~10주)
- **DB↔로그 동기화**: `chat_messages`, `conversation_summaries`, `events/{date}/interactions.jsonl` 간 포인터 관리 프로세스를 문서화하고 모니터링을 추가합니다.
- **재처리 스크립트**: 누락 이벤트나 실패 배치 처리를 보충하기 위한 재처리 도구와 알림을 제공합니다.
- **지식 만료 정책**: 카드 `quality_score`, `feedback_count` 기반 만료/보존 규칙을 자동화하고, 운영 가이드를 작성합니다.

## 4단계: 도구 오케스트레이션 고도화 (10~16주)
- **툴 응답 스키마 표준화**: 각 툴의 입력/출력 스키마를 정의하고 검증 로직을 추가합니다.
- **재시도·롤백 규칙**: 다중 툴 호출 시 우선순위, 실패 시 롤백, 스트리밍/대기 전략을 명문화합니다.
- **운영 제어성**: 운영자가 툴 사용 여부, 재시도 정책을 토글할 수 있는 설정 파일 또는 UI를 제공합니다.

## 5단계: 로그 기반 도메인 적응 강화 (16~24주)
- **지식 승격 워크플로**: `docs/log-driven-domain-adaptation.md`의 Global/Group 레이어 전략을 토대로 그룹 카드 → 글로벌 카드 승격 프로세스를 자동화하고 승인 절차를 마련합니다.
- **품질 지표 확장**: 카드 재사용률, 성공률, 사용자 피드백을 주간 리뷰 루틴으로 편입합니다.
- **경량 파인튜닝 준비**: 누적 지식을 바탕으로 LoRA/경량 파인튜닝 후보를 선정하고 파일럿 모델 검증 계획을 수립합니다.

## 6단계: Agent-to-Agent 확장 (24주~)
- **협력 프로토콜 설계**: 세션 요약, 툴 결과를 매개로 에이전트 간 작업 분담과 합의를 수행하는 최소 협의 프로토콜을 정의합니다.
- **조정 코디네이터 도입**: Agent Supervisor를 추가해 각 에이전트의 목표/토큰 예산/우선순위를 관리하고 충돌을 조정합니다.
- **샌드박스 및 거버넌스**: 상호 호출 루프가 비용/보안 정책을 위반하지 않도록 샌드박스 환경과 감사 로그를 확장합니다.

## 지원 워크스트림
- **모니터링 & 거버넌스**: 월간 비용·성능 리뷰, 개인정보·감사 요구사항 점검, 프롬프트 변경 시 A/B 검증을 상시화합니다.
- **문서화 & 교육**: 각 단계의 설정, 스크립트, 장애 대응 플레이북을 문서화해 온보딩 시간을 단축합니다.
- **실험 관리**: RAG·프롬프트·툴 전략 변경 시 실험 메타데이터를 기록해 회귀 분석과 인과 추적을 가능하게 합니다.

이 로드맵을 따라가면 기능 중심으로 확장된 현 구조를 안정성과 비용 효율을 갖춘 플랫폼으로 전환하고, 로그 기반 도메인 적응 및 agent-to-agent 시나리오까지 단계적으로 실현할 수 있습니다.
