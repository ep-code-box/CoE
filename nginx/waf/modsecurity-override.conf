# This file overrides/extends the base ModSecurity config in the
# owasp/modsecurity-crs:nginx image. It is safe to keep it minimal.

# Start in detection-only mode. Switch to On after tuning.
SecRuleEngine DetectionOnly

# Example custom policy: limit unusual content-types on entity-modifying methods
# Block if Content-Type is NOT one of the allowed list
SecRule REQUEST_METHOD "^(?:POST|PUT|PATCH)$" "\
  id:910020,\
  phase:1,\
  log,deny,status:415,\
  msg:'Suspicious content-type',\
  chain"
  SecRule REQUEST_HEADERS:Content-Type "!@rx ^(?:multipart\/form-data|application\/json|application\/x-www-form-urlencoded|text\/plain)(?:;|$)"
